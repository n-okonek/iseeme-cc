!function(t){"use strict";var o,e,i=function(n){return{orElse:function(t){return null==n?t:n},orElseDo:function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return s(n)?t.apply(e):n},orElseThrow:function(t,e){if(void 0===e&&(e=Error),s(n))throw new e(t);return n}}},s=function(t){return null==t},a=function(){function t(t){this.source={global:{csid:i(t.global.csid),isTestModeEnabled:i(t.global.isTestModeEnabled),isUsingAuditLogs:i(t.global.isUsingAuditLogs),mawDomain:i(t.global.mawDomain),mawProtocol:i(t.global.mawProtocol),cookieDomain:i(t.global.cookieDomain),sourceMap:i(t.global.sourceMap)},modules:t.modules,filterUrls:t.filterUrls}}return t.prototype.enableTestMode=function(){this.source.global.isTestModeEnabled=i(!0)},t.prototype.disableTestMode=function(){this.source.global.isTestModeEnabled=i(!1)},t.prototype.getGlobalConfig=function(){return this.source.global},t.prototype.getModulesConfig=function(){return this.source.modules},t.prototype.getFilterUrls=function(){return this.source.filterUrls},t.prototype.getFilterUrlsForModule=function(t){return this.source.filterUrls[t]||[{}]},t.prototype.getCookieDomain=function(){return this.source.global.cookieDomain.orElse("")},t.prototype.getSourceMap=function(){return this.source.global.sourceMap.orElse(!1)},t}(),u=function(){function t(t,e){this.STORAGE_TTL_SUFFIX="_ttl",this.compatibility=t,this.logger=e}return t.prototype.put=function(t,e,r){this.compatibility.hasLocalStorage?(window.localStorage.setItem(t,e),this.putTtl(t,r)):this.logger.warn("Unable to store value for "+t+" since localStorage is not available.")},t.prototype.putTtl=function(t,e){if(null!=e){var r=Date.now()+e;window.localStorage.setItem(this.getTtlKeyName(t),r.toString())}},t.prototype.getTtlKeyName=function(t){return""+t+this.STORAGE_TTL_SUFFIX},t.prototype.get=function(t){if(!this.compatibility.hasLocalStorage)return this.logger.warn("Unable to retrieve value for "+t+" since localStorage is not available."),null;var e=window.localStorage.getItem(this.getTtlKeyName(t));return null==e?window.localStorage.getItem(t):parseInt(e)<Date.now()?(this.remove(t),null):window.localStorage.getItem(t)},t.prototype.remove=function(t){this.compatibility.hasLocalStorage&&(window.localStorage.removeItem(t),window.localStorage.removeItem(this.getTtlKeyName(t)))},t}();(e=o||(o={})).LOG="LOG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR";var c=function(){function n(t,e){this.logLog=[],this.infoLog=[],this.warnLog=[],this.errorLog=[],this.compatibility=t,this.config=e,this.globalConfig=e.getGlobalConfig()}return n.prototype.log=function(t){this.display(t,window.console.log),this.appendToLogs(t,this.logLog)},n.prototype.info=function(t){this.display(t,window.console.info),this.appendToLogs(t,this.logLog,this.infoLog)},n.prototype.warn=function(t){this.display(t,window.console.warn),this.appendToLogs(t,this.logLog,this.infoLog,this.warnLog)},n.prototype.error=function(t){this.display(t,window.console.error),this.appendToLogs(t,this.logLog,this.infoLog,this.warnLog,this.errorLog)},n.prototype.display=function(t,e){this.isTestModeOrIsAuditing()&&this.compatibility.hasConsole&&"function"==typeof e&&e.call(window,t)},n.prototype.isTestModeOrIsAuditing=function(){return this.globalConfig.isTestModeEnabled.orElse(!1)||this.globalConfig.isUsingAuditLogs.orElse(!1)},n.prototype.appendToLogs=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];t.forEach(function(t){t.length>n.MAX_LOG_LINES&&t.splice(0,1),t.push(e)})},n.prototype.print=function(t){void 0===t&&(t=o.LOG),"string"!=typeof t&&(t=o.LOG);var e=o[t.toUpperCase()];if(void 0===e){var r='Invalid logger level: "'+t+'"';return window.console.error(r),void this.error(r)}var n=this.getLogByLevel(e);n&&window.console.log(n.join("\n"))},n.prototype.getLogByLevel=function(t){return t===o.LOG?this.logLog:t===o.INFO?this.infoLog:t===o.WARN?this.warnLog:(o.ERROR,this.errorLog)},n.prototype.clear=function(){this.logLog=[],this.infoLog=[],this.warnLog=[],this.errorLog=[]},n.MAX_LOG_LINES=1e3,n}(),l={global:{cookieDomain:"",mawProtocol:"https",mawDomain:"maw.bronto.com",csid:"eyJ0eXBlIjoic2l0ZWhhc2giLCJpZCI6IjJmZGYwM2U4NTFiYTcyYjU0YTYyOGMyMmYyNjNlNmEzM2MxYTMzY2M4OGQ4ZWUyMzhhZmVlZDkzOGQ1NTQ0NWUifQ==",sourceMap:!1,isTestModeEnabled:!1,isUsingAuditLogs:!1},modules:{"product-capture-js":{productCaptureProductIdSelectorVisibility:"all",productCaptureProductIdSelectorType:"json",productCaptureProductIdSelectorAttribute:"",productCaptureProductIdSelector:"dataLayer[2]['ecommerce']['detail']['products'][0]['id']",productCaptureFiddlePeriod:40},"contact-capture-js":{emailCaptureSelectors:'input[name="billing[email]"],input[name="email"],input[name="login[username]"],.fb-email,#popup-subcription-inputs-email-fb7ef89a-86f0-482e-81e6-036487ecf304',emailCaptureSubmitSelectors:"input[type=email]",contactIdUrlParameter:"contact_eid",emailCaptureOnSubmitEnabled:!0},"page-visit-capture-js":{}},filterUrls:{"product-capture-js":[{whitelist:[],blacklist:[]}],"page-visit-capture-js":[{whitelist:[],blacklist:[]}],"contact-capture-js":[{whitelist:[],blacklist:[]}]}},d=function(){function t(t,e){this.allowedUrls=t,this.disallowedUrls=e}return t.prototype.isUrlAllowed=function(t){var e=function(e){return function(t){return t.test(e)}};return this.allowedUrls.some(e(t))&&!this.disallowedUrls.some(e(t))},t}(),p=function(){function r(t,e){this.logger=e;var r=t||{};this.config={whitelist:i(r.whitelist),blacklist:i(r.blacklist)}}return r.prototype.getConfig=function(){return this.config},r.prototype.getWhitelist=function(){var t=this.getConfig().whitelist.orElse([r.WHITELIST_DEFAULT]);return t.length<1&&t.push(r.WHITELIST_DEFAULT),this.buildRegExArray(t)},r.prototype.getBlacklist=function(){var t=this.getConfig().blacklist.orElse([r.BLACKLIST_DEFAULT]);return t.length<1&&t.push(r.BLACKLIST_DEFAULT),this.buildRegExArray(t)},r.prototype.buildRegExArray=function(t){var r=this,n=[];return t.filter(function(t){return 0<t.length}).forEach(function(e){try{n.push(new RegExp(r.prepareString(e)))}catch(t){r.logger.error("UrlFilterConfig:buildRegExArray can not create regEx from "+e+", error = "+t)}}),n},r.prototype.prepareString=function(t){var e=r.reverseString(t);return e=e.replace(/\*(?!\.)/g,"*."),e=r.reverseString(e)},r.reverseString=function(t){return t.split("").reverse().join("")},r.WHITELIST_DEFAULT=".*",r.BLACKLIST_DEFAULT="",r}(),f=function(){function o(t,e,r,n){this._hasStarted=!1,this.compatibility=e,this.config=t,this.localStorageWrapper=r,this.logger=n,this.containers={},this.urlFilters={},this.cookieDomain=this.resolveCookieDomain()}return o.getInstance=function(t,e,r,n){return void 0===t&&(t=new a(l)),void 0===e&&(e={}),void 0===r&&(r=new c(e,t)),void 0===n&&(n=new u(e,r)),this.shouldReset||!this._instance?(this.shouldReset=!1,this._instance=new this(t,e,n,r)):this._instance},o.prototype.getLogger=function(){return this.logger},o.prototype.getCompatibility=function(){return this.compatibility},o.prototype.getConfig=function(){return this.config},o.prototype.getLocalStorageWrapper=function(){return this.localStorageWrapper},o.prototype.hasStarted=function(){return this._hasStarted},o.prototype.getCookieDomain=function(){return this.cookieDomain},o.prototype.registerContainer=function(t,e){if(this.containers[t])throw new Error("A container with name '"+t+"' already exists");this.containers[t]=e,this.urlFilters[t]=this.buildUrlFilters(t),this._hasStarted&&this.startContainer(t)},o.prototype.getContainer=function(t){return this.containers[t]},o.prototype.startAllContainers=function(){var e=this;Object.keys(this.containers).forEach(function(t){return e.startContainer(t)}),this._hasStarted=!0},o.prototype.stopAllContainers=function(){var e=this;this.logger.info("Environment:stopAllContainers"),Object.keys(this.containers).forEach(function(t){return e.stopContainer(t)}),this._hasStarted=!1},o.__reset=function(){this.shouldReset=!0},o.prototype.isUrlAllowed=function(t){for(var e=this.urlFilters[t],r=window.location.href,n=0;n<e.length;n++)if(e[n].isUrlAllowed(r))return!0;return!1},o.prototype.startContainer=function(t){this.isUrlAllowed(t)?this.containers[t].start():this.logger.info("Environment:startContainer "+t+" not started, not allowed due to whitelist/blacklist rules.")},o.prototype.stopContainer=function(t){this.containers[t].stop(),this.logger.info("Environment:stopContainer "+t+" has stopped.")},o.prototype.buildUrlFilters=function(t){var r=[],e=o.getInstance().getConfig().getFilterUrlsForModule(t),n=o.getInstance().getLogger();return e.forEach(function(t){var e=new p(t,n);r.push(new d(e.getWhitelist(),e.getBlacklist()))}),r},o.prototype.resolveCookieDomain=function(){try{var t=this.config.getCookieDomain().trim();if(t&&t.length)return t}catch(t){}var e=this.getTopDomain();if(e&&e.length)return"."+e;var r=window.document.location.hostname.split(".");return"."+r.slice(r.length-2,r.length).join(".")},o.prototype.getTopDomain=function(){var t,e;this.logger.log("Environment:getTopDomain");var r="br_t_l_d=cookie",n=document.location.hostname.split(".");for(t=n.length-1;0<=t;t--)if(e=n.slice(t).join("."),document.cookie=r+";domain=."+e+";",-1<document.cookie.indexOf(r))return document.cookie=r.split("=")[0]+"=;domain=."+e+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",e;return""},o}();function r(e,t){if(e.length){for(var r=[];e.length;){var n=e[0],o=new h(n);try{var i=t.get(o.name);i&&i(o.data,o.callback)}catch(t){f.getInstance().hasStarted()?window.console.warn(t):r.push(n)}finally{e.shift()}}r.length&&r.forEach(function(t){return e.push(t)})}}var n,h=function(t){this.name=t[0],t[1]instanceof Function||"function"==typeof t[1]?(this.data={},this.callback=t[1]):(this.data=t[1]||{},this.callback=t[2])},g=function(){function t(t){this.actions=t}return t.getInstance=function(t){return void 0===t&&(t={}),this.shouldReset||!this._instance?(this.shouldReset=!1,this._instance=new this(t)):this._instance},t.prototype.put=function(t,e){if(this.actions[t])throw new Error("An action with name '"+t+"' already exists");this.actions[t]=e},t.prototype.remove=function(t){if(!this.actions[t])throw new Error("An action with name '"+t+"' does not exists");delete this.actions[t]},t.prototype.get=function(t){var e=this.actions[t];if(!e)throw"No action found with name '"+t+"', the container may not have been started due to whitelist/blacklist rules";return e},t.prototype.getAll=function(){return this.actions},t.__reset=function(){this.shouldReset=!0},t}();try{if(window.localStorage){var y="br_w_ls";window.localStorage.setItem(y,"1");var m=window.localStorage.getItem(y);window.localStorage.removeItem(y),n="1"===m}else n=!1}catch(t){n=!1}var v={hasObjectFreeze:"function"==typeof Object.freeze,hasLocalStorage:n,hasConsole:"object"==typeof window.console};function w(t,e){return t(e={exports:{}},e.exports),e.exports}"NodeList"in window&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,e){e=e||window;for(var r=0;r<this.length;r++)t.call(e,this[r],r,this)});var S=w(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),b=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},E=function(n,o,t){if(b(n),void 0===o)return n;switch(t){case 1:return function(t){return n.call(o,t)};case 2:return function(t,e){return n.call(o,t,e)};case 3:return function(t,e,r){return n.call(o,t,e,r)}}return function(){return n.apply(o,arguments)}},C={}.toString,_=function(t){return C.call(t).slice(8,-1)},I=w(function(t){var e=t.exports={version:"2.6.11"};"number"==typeof __e&&(__e=e)}),A=(I.version,w(function(t){var e="__core-js_shared__",r=S[e]||(S[e]={});(t.exports=function(t,e){return r[t]||(r[t]=void 0!==e?e:{})})("versions",[]).push({version:I.version,mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})})),P=0,T=Math.random(),O=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++P+T).toString(36))},L=w(function(t){var e=A("wks"),r=S.Symbol,n="function"==typeof r;(t.exports=function(t){return e[t]||(e[t]=n&&r[t]||(n?r:O)("Symbol."+t))}).store=e}),D=L("toStringTag"),x="Arguments"==_(function(){return arguments}()),N=function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),D))?r:x?_(e):"Object"==(n=_(e))&&"function"==typeof e.callee?"Arguments":n},M=function(t){return"object"==typeof t?null!==t:"function"==typeof t},k=function(t){if(!M(t))throw TypeError(t+" is not an object!");return t},R=function(t){try{return!!t()}catch(t){return!0}},U=!R(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),V=S.document,j=M(V)&&M(V.createElement),F=function(t){return j?V.createElement(t):{}},B=!U&&!R(function(){return 7!=Object.defineProperty(F("div"),"a",{get:function(){return 7}}).a}),G=Object.defineProperty,q={f:U?Object.defineProperty:function(t,e,r){if(k(t),e=function(t,e){if(!M(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!M(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!M(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!M(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")}(e,!0),k(r),B)try{return G(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t}},H=U?function(t,e,r){return q.f(t,e,{enumerable:!((n=1)&n),configurable:!(2&n),writable:!(4&n),value:r});var n}:function(t,e,r){return t[e]=r,t},W={}.hasOwnProperty,K=function(t,e){return W.call(t,e)},Y=A("native-function-to-string",Function.toString),J=w(function(t){var i=O("src"),e="toString",s=(""+Y).split(e);I.inspectSource=function(t){return Y.call(t)},(t.exports=function(t,e,r,n){var o="function"==typeof r;o&&(K(r,"name")||H(r,"name",e)),t[e]!==r&&(o&&(K(r,i)||H(r,i,t[e]?""+t[e]:s.join(String(e)))),t===S?t[e]=r:n?t[e]?t[e]=r:H(t,e,r):(delete t[e],H(t,e,r)))})(Function.prototype,e,function(){return"function"==typeof this&&this[i]||Y.call(this)})}),X="prototype",z=function(t,e,r){var n,o,i,s,a=t&z.F,u=t&z.G,c=t&z.S,l=t&z.P,d=t&z.B,p=u?S:c?S[e]||(S[e]={}):(S[e]||{})[X],f=u?I:I[e]||(I[e]={}),h=f[X]||(f[X]={});for(n in u&&(r=e),r)i=((o=!a&&p&&void 0!==p[n])?p:r)[n],s=d&&o?E(i,S):l&&"function"==typeof i?E(Function.call,i):i,p&&J(p,n,i,t&z.U),f[n]!=i&&H(f,n,s),l&&h[n]!=i&&(h[n]=i)};S.core=I,z.F=1,z.G=2,z.S=4,z.P=8,z.B=16,z.W=32,z.U=64,z.R=128;var Z,$,Q,tt=z,et=function(e,t,r,n){try{return n?t(k(r)[0],r[1]):t(r)}catch(t){var o=e.return;throw void 0!==o&&k(o.call(e)),t}},rt={},nt=L("iterator"),ot=Array.prototype,it=Math.ceil,st=Math.floor,at=Math.min,ut=function(t){return 0<t?at((e=t,isNaN(e=+e)?0:(0<e?st:it)(e)),9007199254740991):0;var e},ct=L("iterator"),lt=I.getIteratorMethod=function(t){if(null!=t)return t[ct]||t["@@iterator"]||rt[N(t)]},dt=w(function(t){var f={},h={},e=t.exports=function(t,e,r,n,o){var i,s,a,u,c,l=o?function(){return t}:lt(t),d=E(r,n,e?2:1),p=0;if("function"!=typeof l)throw TypeError(t+" is not iterable!");if(void 0===(c=l)||rt.Array!==c&&ot[nt]!==c){for(a=l.call(t);!(s=a.next()).done;)if((u=et(a,d,s.value,e))===f||u===h)return u}else for(i=ut(t.length);p<i;p++)if((u=e?d(k(s=t[p])[0],s[1]):d(t[p]))===f||u===h)return u};e.BREAK=f,e.RETURN=h}),pt=L("species"),ft=function(t,e){var r,n=k(t).constructor;return void 0===n||null==(r=k(n)[pt])?e:b(r)},ht=S.document,gt=ht&&ht.documentElement,yt=S.process,mt=S.setImmediate,vt=S.clearImmediate,wt=S.MessageChannel,St=S.Dispatch,bt=0,Et={},Ct="onreadystatechange",_t=function(){var t=+this;if(Et.hasOwnProperty(t)){var e=Et[t];delete Et[t],e()}},It=function(t){_t.call(t.data)};mt&&vt||(mt=function(t){for(var e=[],r=1;arguments.length>r;)e.push(arguments[r++]);return Et[++bt]=function(){!function(t,e,r){var n=void 0===r;switch(e.length){case 0:return n?t():t.call(r);case 1:return n?t(e[0]):t.call(r,e[0]);case 2:return n?t(e[0],e[1]):t.call(r,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(r,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(r,e[0],e[1],e[2],e[3])}t.apply(r,e)}("function"==typeof t?t:Function(t),e)},Z(bt),bt},vt=function(t){delete Et[t]},"process"==_(yt)?Z=function(t){yt.nextTick(E(_t,t,1))}:St&&St.now?Z=function(t){St.now(E(_t,t,1))}:wt?(Q=($=new wt).port2,$.port1.onmessage=It,Z=E(Q.postMessage,Q,1)):S.addEventListener&&"function"==typeof postMessage&&!S.importScripts?(Z=function(t){S.postMessage(t+"","*")},S.addEventListener("message",It,!1)):Z=Ct in F("script")?function(t){gt.appendChild(F("script"))[Ct]=function(){gt.removeChild(this),_t.call(t)}}:function(t){setTimeout(E(_t,t,1),0)});var At={set:mt,clear:vt},Pt=At.set,Tt=S.MutationObserver||S.WebKitMutationObserver,Ot=S.process,Lt=S.Promise,Dt="process"==_(Ot);function xt(t){var r,n;this.promise=new t(function(t,e){if(void 0!==r||void 0!==n)throw TypeError("Bad Promise constructor");r=t,n=e}),this.resolve=b(r),this.reject=b(n)}var Nt={f:function(t){return new xt(t)}},Mt=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},kt=S.navigator,Rt=kt&&kt.userAgent||"",Ut=function(t,e){if(k(t),M(e)&&e.constructor===t)return e;var r=Nt.f(t);return(0,r.resolve)(e),r.promise},Vt=q.f,jt=L("toStringTag"),Ft=L("species"),Bt=L("iterator"),Gt=!1;try{[7][Bt]().return=function(){Gt=!0}}catch(t){}var qt,Ht,Wt,Kt,Yt,Jt,Xt,zt,Zt=At.set,$t=function(){var r,n,o,t=function(){var t,e;for(Dt&&(t=Ot.domain)&&t.exit();r;){e=r.fn,r=r.next;try{e()}catch(t){throw r?o():n=void 0,t}}n=void 0,t&&t.enter()};if(Dt)o=function(){Ot.nextTick(t)};else if(!Tt||S.navigator&&S.navigator.standalone)if(Lt&&Lt.resolve){var e=Lt.resolve(void 0);o=function(){e.then(t)}}else o=function(){Pt.call(S,t)};else{var i=!0,s=document.createTextNode("");new Tt(t).observe(s,{characterData:!0}),o=function(){s.data=i=!i}}return function(t){var e={fn:t,next:void 0};n&&(n.next=e),r||(r=e,o()),n=e}}(),Qt="Promise",te=S.TypeError,ee=S.process,re=ee&&ee.versions,ne=re&&re.v8||"",oe=S[Qt],ie="process"==N(ee),se=function(){},ae=Ht=Nt.f,ue=!!function(){try{var t=oe.resolve(1),e=(t.constructor={})[L("species")]=function(t){t(se,se)};return(ie||"function"==typeof PromiseRejectionEvent)&&t.then(se)instanceof e&&0!==ne.indexOf("6.6")&&-1===Rt.indexOf("Chrome/66")}catch(t){}}(),ce=function(t){var e;return!(!M(t)||"function"!=typeof(e=t.then))&&e},le=function(l,r){if(!l._n){l._n=!0;var n=l._c;$t(function(){for(var u=l._v,c=1==l._s,t=0,e=function(t){var e,r,n,o=c?t.ok:t.fail,i=t.resolve,s=t.reject,a=t.domain;try{o?(c||(2==l._h&&fe(l),l._h=1),!0===o?e=u:(a&&a.enter(),e=o(u),a&&(a.exit(),n=!0)),e===t.promise?s(te("Promise-chain cycle")):(r=ce(e))?r.call(e,i,s):i(e)):s(u)}catch(t){a&&!n&&a.exit(),s(t)}};n.length>t;)e(n[t++]);l._c=[],l._n=!1,r&&!l._h&&de(l)})}},de=function(i){Zt.call(S,function(){var t,e,r,n=i._v,o=pe(i);if(o&&(t=Mt(function(){ie?ee.emit("unhandledRejection",n,i):(e=S.onunhandledrejection)?e({promise:i,reason:n}):(r=S.console)&&r.error&&r.error("Unhandled promise rejection",n)}),i._h=ie||pe(i)?2:1),i._a=void 0,o&&t.e)throw t.v})},pe=function(t){return 1!==t._h&&0===(t._a||t._c).length},fe=function(e){Zt.call(S,function(){var t;ie?ee.emit("rejectionHandled",e):(t=S.onrejectionhandled)&&t({promise:e,reason:e._v})})},he=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),le(e,!0))},ge=function(t){var r,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw te("Promise can't be resolved itself");(r=ce(t))?$t(function(){var e={_w:n,_d:!1};try{r.call(t,E(ge,e,1),E(he,e,1))}catch(t){he.call(e,t)}}):(n._v=t,n._s=1,le(n,!1))}catch(t){he.call({_w:n,_d:!1},t)}}};ue||(oe=function(t){!function(t,e,r,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(r+": incorrect invocation!")}(this,oe,Qt,"_h"),b(t),qt.call(this);try{t(E(ge,this,1),E(he,this,1))}catch(t){he.call(this,t)}},(qt=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(t,e,r){for(var n in e)J(t,n,e[n],r);return t}(oe.prototype,{then:function(t,e){var r=ae(ft(this,oe));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=ie?ee.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&le(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),Wt=function(){var t=new qt;this.promise=t,this.resolve=E(ge,t,1),this.reject=E(he,t,1)},Nt.f=ae=function(t){return t===oe||t===Kt?new Wt(t):Ht(t)}),tt(tt.G+tt.W+tt.F*!ue,{Promise:oe}),Jt=Qt,(Yt=oe)&&!K(Yt=Xt?Yt:Yt.prototype,jt)&&Vt(Yt,jt,{configurable:!0,value:Jt}),zt=S[Qt],U&&zt&&!zt[Ft]&&q.f(zt,Ft,{configurable:!0,get:function(){return this}}),Kt=I[Qt],tt(tt.S+tt.F*!ue,Qt,{reject:function(t){var e=ae(this);return(0,e.reject)(t),e.promise}}),tt(tt.S+tt.F*!ue,Qt,{resolve:function(t){return Ut(this,t)}}),tt(tt.S+tt.F*!(ue&&function(t,e){if(!e&&!Gt)return!1;var r=!1;try{var n=[7],o=n[Bt]();o.next=function(){return{done:r=!0}},n[Bt]=function(){return o},t(n)}catch(t){}return r}(function(t){oe.all(t).catch(se)})),Qt,{all:function(t){var s=this,e=ae(s),a=e.resolve,u=e.reject,r=Mt(function(){var n=[],o=0,i=1;dt(t,!1,function(t){var e=o++,r=!1;n.push(void 0),i++,s.resolve(t).then(function(t){r||(r=!0,n[e]=t,--i||a(n))},u)}),--i||a(n)});return r.e&&u(r.v),e.promise},race:function(t){var e=this,r=ae(e),n=r.reject,o=Mt(function(){dt(t,!1,function(t){e.resolve(t).then(r.resolve,n)})});return o.e&&n(o.v),r.promise}}),tt(tt.P+tt.R,"Promise",{finally:function(e){var r=ft(this,I.Promise||S.Promise),t="function"==typeof e;return this.then(t?function(t){return Ut(r,e()).then(function(){return t})}:e,t?function(t){return Ut(r,e()).then(function(){throw t})}:e)}});I.Promise.finally;var ye,me=w(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});if((ye=me)&&ye.__esModule&&Object.prototype.hasOwnProperty.call(ye,"default")&&ye.default,!window.brontoBundleLoaded)if(window.brontoBundleLoaded=!0,void 0===window.brontoCookieConsent&&(window.brontoCookieConsent=!0),navigator.cookieEnabled&&window.brontoCookieConsent){Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Date.now||(Date.now=function(){return(new Date).getTime()}),Object.seal||(Object.seal=function(t){return t}),function(){if(!document.querySelectorAll&&!document.querySelector){var i=document.createStyleSheet(),e=function(t,e){var r=document.all,n=[];i.addRule(t,"foo:bar");for(var o=0;o<r.length&&!("bar"===r[o].currentStyle.foo&&(n.push(r[o]),n.length>e));o++);return i.removeRule(0),n};document.querySelectorAll=function(t){return e(t,1/0)},document.querySelector=function(t){return e(t,1)[0]||null}}}(),String.prototype.endsWith||(String.prototype.endsWith=function(t){return!(this.length<t.length)&&this.lastIndexOf(t)===this.length-t.length}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(t,e){var r=0<e?0|e:0;return this.substring(r,r+t.length)===t}});var ve=new a(l),we=new c(v,ve),Se=new u(v,we),be=f.getInstance(ve,v,we,Se);window.onunhandledrejection||(window.onunhandledrejection=function(t){we.info("Promise unhandledrejection "+t)}),we.info("Script Manager: Script successfully loaded.");var Ee=be.getConfig().getGlobalConfig().csid.orElseThrow("csid is required, but is missing from config");we.info("Script Manager: Site ID: "+Ee);var Ce=function(){},_e=g.getInstance();_e.put("enableTestMode",function(){return f.getInstance().getConfig().enableTestMode()}),_e.put("setCsid",Ce),_e.put("log:print",function(t){var e=be.getLogger();e&&e.print(t)}),_e.put("cookies:consent",function(t){var e=!0===t,r=!0===window.brontoCookieConsent;window.brontoCookieConsent=e;var n=be.getLogger();n&&n.info("Script Manager: cookies:consent: enabled: "+e),e?r||be.hasStarted()||be.startAllContainers():(be.stopAllContainers(),Object.keys(g.getInstance().getAll()).forEach(function(t){"enableTestMode"!=t&&"setCsid"!=t&&"log:print"!=t&&"cookies:consent"!=t&&g.getInstance().remove(t)}))}),r(window.bronto.q,_e),be.startAllContainers();t.go=window.bronto.q?function(){return r(window.bronto.q,_e)}:Ce}else window.console&&window.console.warn("Script Manager: Script is stopped because cookies are disabled.");var Ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};function Ae(t,e){function r(){this.constructor=t}Ie(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Pe=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};!function(t){if(!t.fetch){var e="URLSearchParams"in t,r="Symbol"in t&&"iterator"in Symbol,s="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),n="FormData"in t,o="ArrayBuffer"in t;if(o)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<i.indexOf(Object.prototype.toString.call(t))};h.prototype.append=function(t,e){t=d(t),e=p(e);var r=this.map[t];this.map[t]=r?r+","+e:e},h.prototype.delete=function(t){delete this.map[d(t)]},h.prototype.get=function(t){return t=d(t),this.has(t)?this.map[t]:null},h.prototype.has=function(t){return this.map.hasOwnProperty(d(t))},h.prototype.set=function(t,e){this.map[d(t)]=p(e)},h.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},h.prototype.keys=function(){var r=[];return this.forEach(function(t,e){r.push(e)}),f(r)},h.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),f(e)},h.prototype.entries=function(){var r=[];return this.forEach(function(t,e){r.push([e,t])}),f(r)},r&&(h.prototype[Symbol.iterator]=h.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];S.prototype.clone=function(){return new S(this,{body:this._bodyInit})},w.call(S.prototype),w.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var l=[301,302,303,307,308];E.redirect=function(t,e){if(-1===l.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=h,t.Request=S,t.Response=E,t.fetch=function(r,o){return new Promise(function(n,t){var e=new S(r,o),i=new XMLHttpRequest;i.onload=function(){var t,o,e={status:i.status,statusText:i.statusText,headers:(t=i.getAllResponseHeaders()||"",o=new h,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),r=e.shift().trim();if(r){var n=e.join(":").trim();o.append(r,n)}}),o)};e.url="responseURL"in i?i.responseURL:e.headers.get("X-Request-URL");var r="response"in i?i.response:i.responseText;n(new E(r,e))},i.onerror=function(){t(new TypeError("Network request failed"))},i.ontimeout=function(){t(new TypeError("Network request failed"))},i.open(e.method,e.url,!0),"include"===e.credentials?i.withCredentials=!0:"omit"===e.credentials&&(i.withCredentials=!1),"responseType"in i&&s&&(i.responseType="blob"),e.headers.forEach(function(t,e){i.setRequestHeader(e,t)}),i.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function d(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function p(t){return"string"!=typeof t&&(t=String(t)),t}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function g(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function y(r){return new Promise(function(t,e){r.onload=function(){t(r.result)},r.onerror=function(){e(r.error)}})}function m(t){var e=new FileReader,r=y(e);return e.readAsArrayBuffer(t),r}function v(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function w(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(s&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(n&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(o&&s&&a(t))this._bodyArrayBuffer=v(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!o||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s&&(this.blob=function(){var t=g(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(m)}),this.text=function(){var t,e,r,n=g(this);if(n)return n;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,r=y(e),e.readAsText(t),r;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),n=0;n<e.length;n++)r[n]=String.fromCharCode(e[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}function S(t,e){var r,n,o=(e=e||{}).body;if(t instanceof S){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new h(t.headers)),this.method=t.method,this.mode=t.mode,o||null==t._bodyInit||(o=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new h(e.headers)),this.method=(r=e.method||this.method||"GET",n=r.toUpperCase(),-1<c.indexOf(n)?n:r),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function b(t){var o=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),r=e.shift().replace(/\+/g," "),n=e.join("=").replace(/\+/g," ");o.append(decodeURIComponent(r),decodeURIComponent(n))}}),o}function E(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new h(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var Te,Oe,Le=function(){function t(){this._uuid=this.uuid()}return t.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},t.prototype.toString=function(){return this._uuid},t}(),De=function(){function e(t,e,r){if(!t)throw new Error("name is required");this.name=t,this.value=e?e.toString():"",r&&(this.expiry=r.toUTCString()),this.domain=this.getDomain()}return e.prototype.getName=function(){return this.name},e.prototype.getValue=function(){return this.value},e.prototype.getExpiry=function(){return this.expiry},e.prototype.getDomain=function(){return f.getInstance(new a(l)).getCookieDomain()},e.prototype.isTrackingCookie=function(){return e.isTrackingCookie(this.getName())},e.isTrackingCookie=function(t){return-1<t.indexOf(e.TRACK_PASSTHRU_TID_NAME)||-1<t.indexOf(e.LEGACY_TID_NAME)},e.prototype.toString=function(){var t=encodeURIComponent(this.value),e=this.name+"="+t+";path=/";return this.domain&&(e+=";domain="+this.domain),this.expiry&&(e+=";expires="+this.expiry),e+";SameSite=None; Secure"},e.SUPER_COOKIE_NAME="bs_t_",e.BROWSER_CLOSE_NAME="bs_t_bc_",e.TRACK_PASSTHRU_TID_NAME="_bta_tid",e.LEGACY_TID_NAME="tid_",e}(),xe=function(){function t(){}return t.prototype.getAll=function(){var t=window.document;return t.cookie&&t.cookie.length?t.cookie.split(";").map(function(t){var e=t.split("="),r=e[0],n=e[1];if(r&&n)return new De(r.trim(),n.trim(),void 0)}).filter(function(t){return void 0!==t}):[]},t.prototype.get=function(e){return e?this.getAll().filter(function(t){return t.name===e})[0]:null},t.prototype.remove=function(t){this.put(new De(t,""))},t.prototype.put=function(t){window.document.cookie=t.toString()},t.prototype.getCookieValue=function(t){var e=this.get(t);return e?e.getValue():null},t}(),Ne=function(){function t(){}return t.getId=function(){var e=this,r=new xe,t=r.getCookieValue(this.SHOPPER_ID_COOKIE_NAME),n=i(t).orElseDo(function(){n=(new Le).toString();var t=new Date((new Date).getTime()+63072e7);return r.put(new De(e.SHOPPER_ID_COOKIE_NAME,n,t)),n});return n},t.SHOPPER_ID_COOKIE_NAME="b_s_id",t.SHOPPER_ID_HEADER="x-shopper-id",t}(),Me=function(){function n(t){this.globalConfig=t.getGlobalConfig(),this.shopperId=Ne.getId()}return n.prototype.sendRequest=function(t,e,r){return r=r||{},n.makeRequest(t,e,this.shopperId,r)},n.makeRequest=function(t,e,r,n){var o={headers:{"Content-Type":"application/json","X-Ref-Url":window.location.href},method:"POST",body:JSON.stringify(e)};return o.headers=Pe({},n,o.headers),o.headers[Ne.SHOPPER_ID_HEADER]=r,fetch(t,o)},n.prototype.buildUrl=function(t){var e=this.globalConfig.mawDomain.orElseThrow("maw domain is missing");return this.globalConfig.mawProtocol.orElse(document.location.protocol)+"://"+e+"/"+t},n}(),ke=function(n){function t(t){var e=n.call(this,t)||this,r=t.getGlobalConfig().csid.orElseThrow("csid is missing");return e.sendContactEndpoint=e.buildUrl("csites/"+r+"/shoppers/"),e}return Ae(t,n),t.prototype.sendShopper=function(t){var e=this.sendContactEndpoint+t.shopperId;return this.sendRequest(e,t)},t}(Me);(Oe=Te||(Te={})).TEST="test",Oe.PRODUCTION="production";var Re=function(){function t(t){t&&(this.shopperId=t.shopperId,this.emailAddress=t.emailAddress,this.contactId=t.contactId,this.mode=t.mode)}return t.prototype.isEqual=function(t){var e=!1;return t&&(e=this.shopperId==t.shopperId&&this.emailAddress==t.emailAddress&&this.contactId==t.contactId&&this.mode==t.mode),e},t}(),Ue="contact-capture-js",Ve=function(){function t(){var t=f.getInstance().getConfig().getModulesConfig()[Ue]||{};this.config={emailCaptureOnSubmitEnabled:i(t.emailCaptureOnSubmitEnabled),emailCaptureSubmitSelectors:i(t.emailCaptureSubmitSelectors),emailCaptureSelectors:i(t.emailCaptureSelectors),contactIdUrlParameter:i(t.contactIdUrlParameter)}}return t.prototype.getConfig=function(){return this.config},t.prototype.getEmailCaptureOnSubmitEnabled=function(){return this.getConfig().emailCaptureOnSubmitEnabled.orElse(!1)},t.prototype.getEmailCaptureSubmitSelectors=function(){return this.getConfig().emailCaptureSubmitSelectors.orElse("")},t.prototype.getEmailCaptureSelectors=function(){return this.getConfig().emailCaptureSelectors.orElse("")},t.prototype.getContactIdUrlParameter=function(){var e=this;this.contactIdUrlParameter||(this.contactIdUrlParameter=[],this.getConfig().contactIdUrlParameter.orElse("").split(",").forEach(function(t){return e.contactIdUrlParameter.push(t.trim())}));return this.contactIdUrlParameter},t}(),je=function(){function r(t){this.contactCapture=t,this.moduleConfig=new Ve,this.logger=f.getInstance().getLogger(),this.captureOnClickOnly=this.moduleConfig.getEmailCaptureOnSubmitEnabled(),this.onClickSelectors=this.moduleConfig.getEmailCaptureSubmitSelectors().split(","),this.captureSelectors=this.moduleConfig.getEmailCaptureSelectors().split(","),this.blurListeners=[],this.clickListeners=[],this.keyupListeners=[]}return r.prototype.start=function(){if(this.timer){clearTimeout(this.timer);this.logger.info("EmailCapture: start cleared timer")}this.findAndSendEmail(document.body),this.addListenersElements(document.body),this.addMutationObserver()},r.prototype.delayedStart=function(){var t=this;this.timer=setTimeout(function(){t.start()},r.DELAY_START_MS);this.logger.info("EmailAddressCapture: delayedStart set timeout on start")},r.prototype.stop=function(){if(this.timer){clearTimeout(this.timer);this.logger.info("EmailAddressCapture: stop cleared timer")}this.observer.disconnect()},r.prototype.addMutationObserver=function(){this.observer=new MutationObserver(this.mutationCallback.bind(this)),this.observer.observe(document.body,{attributes:!1,childList:!0,subtree:!0})},r.prototype.mutationCallback=function(t,e){for(var r=0,n=t;r<n.length;r++){var o=n[r];if("childList"==o.type){for(var i=0,s=o.addedNodes;i<s.length;i++){var a=s[i];this.captureOnClickOnly||this.findAndSendEmail(a.parentNode),this.addListenersElements(a.parentNode)}for(var u=0,c=o.removedNodes;u<c.length;u++){var l=c[u];this.removeObserver(l)}}}},r.prototype.addListenersElements=function(e){var r=this;(this.captureOnClickOnly?this.onClickSelectors:this.captureSelectors).map(function(t){try{return t.length<1?(r.logger.info("EmailAddressCapture: no email capture selectors specified for on submit."),null):e.querySelector(t.trim())}catch(t){r.logger.error("EmailAddressCapture: addListenersElements failure err = "+t)}return null}).filter(function(t){return!!t}).forEach(function(t){return r.observe(t)})},r.prototype.observe=function(t){var e=this;this.captureOnClickOnly&&this.clickListeners.indexOf(t)<0?(t.addEventListener("click",function(){return e.clickHandler()}),this.clickListeners.push(t)):(this.blurListeners.indexOf(t)<0&&(t.addEventListener("blur",function(t){return e.blurHandler(t)}),this.blurListeners.push(t)),this.keyupListeners.indexOf(t)<0&&(t.addEventListener("keyup",function(t){return e.keyPressedHandler(t)}),this.keyupListeners.push(t)))},r.prototype.removeObserver=function(t){var e=this.blurListeners.indexOf(t);-1<e&&this.blurListeners.splice(e,1);var r=this.clickListeners.indexOf(t);-1<r&&this.clickListeners.splice(r,1);var n=this.keyupListeners.indexOf(t);if(-1<n&&this.keyupListeners.splice(n,1),t.children)for(var o=0;o<t.children.length;o++)this.removeObserver(t.children[o])},r.prototype.findAndSendEmail=function(e){var r=this;this.captureSelectors.map(function(t){try{return t.length<1?(r.logger.info("EmailAddressCapture: cssSelector selectors empty."),null):e.querySelector(t.trim())}catch(t){r.logger.error("EmailAddressCapture: findAndSendEmail failure err = "+t)}return null}).filter(function(t){return!!t}).forEach(function(t){r.sendEmailAddress(r.getValue(t))})},r.prototype.getValue=function(t){return t instanceof HTMLInputElement?i(t.value).orElse(""):i(t.textContent).orElse("")},r.prototype.keyPressedHandler=function(t){t.code==r.ENTER_KEYCODE&&this.blurHandler(t)},r.prototype.clickHandler=function(){this.findAndSendEmail(document.body)},r.prototype.blurHandler=function(t){var e=t.currentTarget,r=this.getValue(e);this.sendEmailAddress(r)},r.prototype.sendEmailAddress=function(t){var e=t.trim();r.isValidAddress(e)&&this.contactCapture.sendEmailAddress(e)},r.isValidAddress=function(t){return r.EMAIL_REGEX.test(t)},r.ENTER_KEYCODE="Enter",r.EMAIL_REGEX=/^.+@.+\..+$/,r.DELAY_START_MS=1e3,r}(),Fe=function(){function t(t){this.maw=t,this.logger=f.getInstance().getLogger(),this.subscribeForCapturedEmailAddress()}return t.prototype.sendContact=function(t){return this.maw.sendShopper(t)},t.prototype.sendContactId=function(t){var r=this,n=this.createShopper({contactId:t});return new Promise(function(t,e){n&&!n.isEqual(r.lastShopperSent)?r.maw.sendShopper(n).then(function(){r.lastShopperSent=n,t()}).catch(function(t){r.logger.error("ContactCapture: sendContactId failure contact = "+JSON.stringify(n)+", err = "+t),e(t)}):t()})},t.prototype.sendEmailAddress=function(t){var r=this,n=this.createShopper({emailAddress:t});return new Promise(function(t,e){n&&!n.isEqual(r.lastShopperSent)?r.maw.sendShopper(n).then(function(){r.lastShopperSent=n,t()}).catch(function(t){r.logger.error("ContactCapture: sendEmailAddress failure contact = "+JSON.stringify(n)+", err = "+t),e(t)}):t()})},t.prototype.subscribeForCapturedEmailAddress=function(){var r=this;document.addEventListener(t.CAPTURE_EMAIL_ADDRESS_EVENT,function(t){if(t&&t.detail&&("string"==typeof t.detail||t.detail instanceof String)){var e=t.detail.trim();e&&je.isValidAddress(e)&&r.sendEmailAddress(e).then(function(t){r.logger.info("EmailAddress sent")}).catch(function(t){r.logger.info("EmailAddress not sent")})}})},t.prototype.createShopper=function(t){var e=new Re(t);if(e.shopperId=e.shopperId||Ne.getId(),e.mode=e.mode||Te.PRODUCTION,e.contactId&&!(e.contactId.length<1)||e.emailAddress&&!(e.emailAddress.length<1))return e},t.CAPTURE_EMAIL_ADDRESS_EVENT="bronto:emailAddress:capture",t}(),Be=function(){function t(){}return t.prototype.getAll=function(){return window.document.location.search.length?t.format(window.document.location.search).split("&").reduce(function(t,e){var r=e.split("="),n=r[0],o=r[1];return t[n]=decodeURIComponent(o),t},{}):{}},t.prototype.get=function(e){var t=this.getAll(),r=Object.keys(t).filter(function(t){return 0===t.indexOf(e)})[0];return{name:r,value:t[r]}},t.format=function(t){return t.replace(/^\?/,"")},t}(),Ge=function(){function e(t){this.contactCapture=t,this.contactIdUrlParameter=(new Ve).getContactIdUrlParameter(),this.queryString=new Be,this.logger=f.getInstance().getLogger()}return e.prototype.start=function(){if(this.timer){clearTimeout(this.timer);this.logger.info("ContactIdCapture: start cleared timer")}this.findAndSendContactId()},e.prototype.delayedStart=function(){var t=this;this.timer=setTimeout(function(){t.start()},e.DELAY_START_MS);this.logger.info("ContactIdCapture: delayedStart set timeout on start")},e.prototype.getContactId=function(){var e=this,t=this.queryString.getAll();return t[Object.keys(t).filter(function(t){return-1<e.contactIdUrlParameter.indexOf(t.trim())})[0]]},e.prototype.findAndSendContactId=function(){var e=this,t=this.getContactId();if(t){var r=t.trim();this.contactCapture.sendContactId(r).then(function(t){e.logger.info("ContactId sent")}).catch(function(t){e.logger.info("ContactId not sent")})}},e.DELAY_START_MS=1e3,e}(),qe=function(){function r(t){this.contactCapture=t,this.emailCapture=new je(t),this.contactIdCapture=new Ge(t),this.logger=f.getInstance().getLogger()}return r.prototype.start=function(){var t=this;if(g.getInstance().put(r.SEND_EMAIL_ADDRESS_ACTION_NAME,this.contactCapture.sendEmailAddress.bind(this.contactCapture)),g.getInstance().put(r.SEND_CONTACT_ID_ACTION_NAME,this.contactCapture.sendContactId.bind(this.contactCapture)),"complete"===document.readyState){var e="ContactCaptureContainer: start readyState=complete, delaying start";this.logger.info(e),this.contactIdCapture.delayedStart(),this.emailCapture.delayedStart()}else{e="ProductCaptureContainer: start delaying further start to window load";this.logger.info(e),window.addEventListener("load",function(){t.contactIdCapture.delayedStart(),t.emailCapture.delayedStart()})}},r.prototype.stop=function(){this.emailCapture.stop()},r.SEND_EMAIL_ADDRESS_ACTION_NAME="emailAddress:send",r.SEND_CONTACT_ID_ACTION_NAME="contactId:send",r.NAME=Ue,r}(),He=f.getInstance(),We=new qe(new Fe(new ke(He.getConfig())));He.registerContainer(qe.NAME,We);var Ke=function(n){function t(t){var e=n.call(this,t)||this,r=t.getGlobalConfig().csid.orElseThrow("csid is missing");return e.sendPageVisitEndpoint=e.buildUrl("csites/"+r+"/browse/pageVisit"),e}return Ae(t,n),t.prototype.sendPageVisit=function(t){return this.sendRequest(this.sendPageVisitEndpoint,t)},t}(Me),Ye="page-visit-capture-js",Je=function(){function t(){var t=f.getInstance().getConfig().getModulesConfig()[Ye];this.config={pageVisitExpiryDays:i(t.pageVisitExpiryDays)}}return t.prototype.getConfig=function(){return this.config},t.prototype.getPageVisitExpiryDays=function(){return this.getConfig().pageVisitExpiryDays.orElse(1)},t}(),Xe=function(t){t||(t={}),this.timeStamp=new Date(t.timeStamp).toLocaleString(),"Invalid Date"===this.timeStamp&&(this.timeStamp=(new Date).toLocaleString(),f.getInstance().getLogger().warn("PageVisit: Invalid or missing timeStamp, using "+this.timeStamp))},ze=function(){function s(t){this.maw=t,this.moduleConfig=new Je,this.logger=f.getInstance().getLogger(),this.cookies=new xe,this.expiry=this.moduleConfig.getPageVisitExpiryDays()}return s.prototype.start=function(){var e=this,t=new Xe({timeStamp:(new Date).toLocaleString()});this.checkAndSendPageVisit(t).then(function(t){e.logger.info("PageVisit sent")}).catch(function(t){e.logger.info("PageVisit not sent")})},s.prototype.stop=function(){},s.prototype.sendPageVisit=function(n){var o=this;return new Promise(function(e,r){if(n)o.maw.sendPageVisit(n).then(function(t){o.logger.info("PageVisitCapture: Page Visit event sent"),e(t)}).catch(function(t){o.logger.error("PageVisitCapture: sendPageVisit failure pageVisit = "+JSON.stringify(n)+", err = "+t),r(t)});else{var t="PageVisitCapture: sendPageVisit empty pageVisit not sent = "+JSON.stringify(n);o.logger.warn(t),e(t)}})},s.prototype.checkAndSendPageVisit=function(o){var i=this;return new Promise(function(r,e){if(i.cookies.getCookieValue(s.PAGE_VISIT_COOKIE_NAME))r();else{var n=new Date,t=new Xe(o);i.sendPageVisit(t).then(function(t){var e=i.getLocaleMidnight();i.cookies.put(new De(s.PAGE_VISIT_COOKIE_NAME,n.toLocaleString(),e)),r(t)}).catch(function(t){i.logger.error("PageVisitCapture: sendPageVisit failure pageVisit = "+JSON.stringify(o)+", err = "+t),e(t)})}})},s.prototype.getLocaleMidnight=function(){var t=new Date,e=new Date(t.getTime()+60*t.getTimezoneOffset()*1e3),r=t.getTimezoneOffset()/60;return e.setHours(t.getHours()-r),e.setDate(e.getDate()+this.expiry),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e},s.PAGE_VISIT_COOKIE_NAME="b_pg_v",s}(),Ze=function(){function t(t){this.pageVisitCapture=t}return t.prototype.start=function(){g.getInstance().put(t.SEND_PAGE_VISIT_ACTION_NAME,this.pageVisitCapture.checkAndSendPageVisit.bind(this.pageVisitCapture)),this.pageVisitCapture.start()},t.prototype.stop=function(){},t.SEND_PAGE_VISIT_ACTION_NAME="pageVisit:send",t.NAME=Ye,t}(),$e=f.getInstance(),Qe=new Ze(new ze(new Ke($e.getConfig())));$e.registerContainer(Ze.NAME,Qe);var tr,er,rr,nr,or=function(n){function t(t){var e=n.call(this,t)||this,r=t.getGlobalConfig().csid.orElseThrow("csid is missing");return e.sendProductViewEndpoint=e.buildUrl("csites/"+r+"/browse/productView"),e.sendProductFiddleEndpoint=e.buildUrl("csites/"+r+"/browse/fiddle"),e}return Ae(t,n),t.prototype.sendProductView=function(t){return this.sendRequest(this.sendProductViewEndpoint,t)},t.prototype.sendProductFiddle=function(t){return this.sendRequest(this.sendProductFiddleEndpoint,t)},t}(Me),ir=function(t){t&&(this.productId=""+t.productId,this.productId=this.productId.trim(),this.timeStamp=t.timeStamp||(new Date).getTime())},sr="product-capture-js";(er=tr||(tr={})).JSON="JSON",er.CSS="CSS",(nr=rr||(rr={})).VISIBLE_ONLY="visible",nr.ALL="all";var ar=function(){function t(){var t=f.getInstance().getConfig().getModulesConfig()[sr];this.config={productCaptureProductIdSelector:i(t.productCaptureProductIdSelector),productCaptureProductIdSelectorVisibility:i(t.productCaptureProductIdSelectorVisibility),productCaptureProductIdSelectorAttribute:i(t.productCaptureProductIdSelectorAttribute),productCaptureProductIdSelectorType:i(t.productCaptureProductIdSelectorType),productCaptureFiddlePeriod:i(t.productCaptureFiddlePeriod)}}return t.prototype.getConfig=function(){return this.config},t.prototype.getProductCaptureProductIdSelector=function(){return this.getConfig().productCaptureProductIdSelector.orElse("")},t.prototype.getProductCaptureProductIdSelectorVisibility=function(){return this.getConfig().productCaptureProductIdSelectorVisibility.orElse(rr.ALL).toLowerCase()==rr.VISIBLE_ONLY},t.prototype.getProductCaptureProductIdSelectorAttribute=function(){return this.getConfig().productCaptureProductIdSelectorAttribute.orElse("")},t.prototype.getProductCaptureProductIdSelectorType=function(){return this.getConfig().productCaptureProductIdSelectorType.orElse(tr.CSS).toUpperCase()},t.prototype.getProductCaptureFiddlePeriod=function(){return 6e4*this.getConfig().productCaptureFiddlePeriod.orElse(t.DEFAULT_FIDDLE_INTERVAL)},t.DEFAULT_FIDDLE_INTERVAL=20,t}(),ur=function(){function o(t){this.productsSent=new Map,this.productsSentPending=new Map,this.maw=t,this.moduleConfig=new ar,this.logger=f.getInstance().getLogger(),this.productsSent=new Map,this.productsSentPending=new Map,this.fiddleInterval=this.moduleConfig.getProductCaptureFiddlePeriod()}return o.prototype.start=function(){if(this.timer){clearTimeout(this.timer);this.logger.info("ProductCapture: start cleared timer")}this.findAndSendProductViews(),this.addMutationObserver(),this.startProductFiddle()},o.prototype.delayedStart=function(){var t=this;this.timer=setTimeout(function(){t.start()},o.DELAY_START_MS);this.logger.info("ProductCapture: delayedStart set timeout on start")},o.prototype.stop=function(){if(this.timer){clearTimeout(this.timer);this.logger.info("ProductCapture: stop cleared timer")}this.observer&&this.observer.disconnect(),this.stopProductFiddle()},o.prototype.addMutationObserver=function(){if(this.moduleConfig.getProductCaptureProductIdSelectorType()==tr.CSS){this.observer=new MutationObserver(this.mutationCallback.bind(this)),this.observer.observe(document,{attributes:!1,childList:!0,subtree:!0})}},o.prototype.mutationCallback=function(t,e){for(var r=0,n=t;r<n.length;r++){var o=n[r];if("childList"==o.type)for(var i=0,s=o.addedNodes;i<s.length;i++){var a=s[i];this.findAndSendProductViewsByCssSelectors(a.parentNode)}}},o.prototype.shouldSendProduct=function(t,e){var r=e[t.productId];if(!r)return!0;var n=(new Date).getTime();return o.PRODUCT_SENT_EXPIRE_MS<n-r},o.prototype.filterSentProducts=function(t){var e=this,r=[];return 0<t.length&&t.forEach(function(t){e.shouldSendProduct(t,e.productsSent)&&e.shouldSendProduct(t,e.productsSentPending)&&r.push(t)}),r},o.prototype.sendProductView=function(i){var s=this;return new Promise(function(e,r){var t=s.createProducts(i);if(t&&t.length<1){var n="ProductCapture: sendProductView empty products not sent";s.logger.warn(n),e(n)}else{var o=s.filterSentProducts(t);if(0<o.length)o.forEach(function(t){s.productsSentPending[t.productId]=t.timeStamp}),s.maw.sendProductView(o).then(function(t){o.forEach(function(t){s.productsSent[t.productId]=t.timeStamp}),s.productsSentPending=new Map,s.publishProductView(o),e(t)}).catch(function(t){s.productsSentPending=new Map,s.logger.error("ProductCapture: sendProductView failure products = "+JSON.stringify(o)+", err = "+t),r(t)});else{n="ProductCapture: sendProductView products already sent or pending";s.logger.info(n),e(n)}}})},o.prototype.publishProductView=function(t){if(t&&0<t.length){var e=new CustomEvent(o.PRODUCT_VIEW_SEND_EVENT,{detail:t});document.dispatchEvent(e)}},o.prototype.getValueFromJSON=function(t){var e=/\[('([^']+)'|"([^"]+)"|([0-9]+))\]/g,r=/^([a-zA-Z_$][0-9a-zA-Z_$]*)($|(\[('[^']+'|"[^"]+"|[0-9]+)\])+)$/.exec(t);if(!r||r.length<2)return null;var n=r[1],o=[];if(2<r.length){var i=r[2];if(i)for(var s=void 0;s=e.exec(i);){var a=s[1];a="'"===a.charAt(0)||'"'===a.charAt(0)?a.substring(1,a.length-1):Number(a),o.push(a)}}for(var u=window[n],c=0;u&&c<o.length;c++){u=u[o[c]]}return"object"==typeof u&&(u=null),u},o.prototype.getContent=function(t){var e,r=null;switch(this.getElementName(t)){case"input":r=t.value;break;case"textarea":r=t.value;break;case"option":r=t.value;break;case"select":r=(e=t).options[e.selectedIndex].value;break;default:r=t.innerText||t.textContent}return r},o.prototype.getElementContent=function(t,e){return e?t.getAttribute(e):this.getContent(t)},o.prototype.isElementVisible=function(t){return null!==t&&(t===document.body||t===document.head||null===t.parentElement||t.parentElement===document.head||("getComputedStyle"in window?e=window.getComputedStyle(t):"currentStyle"in t&&(e=t.currentStyle),"none"!==e.display&&0!==e.opacity&&"hidden"!==e.visibility&&this.isElementVisible(t.parentElement)));var e},o.prototype.getElementName=function(t){return t.nodeName.toLowerCase()},o.prototype.findAndSendProductViews=function(){var t=this.moduleConfig.getProductCaptureProductIdSelectorType();switch(t){case tr.CSS:this.findAndSendProductViewsByCssSelectors(document);break;case tr.JSON:this.findAndSendProductViewsByJsonSelectors();break;default:this.logger.error("ProductCapture: findAndSendProductViews unknown selector type = "+t)}},o.prototype.findAndSendProductViewsByJsonSelectors=function(){var e=this,t=this.getValueFromJSON(this.moduleConfig.getProductCaptureProductIdSelector());t&&0<(t=""+t).trim().length&&this.sendProductView([new ir({productId:t,timeStamp:(new Date).getTime()})]).then(function(t){e.logger.info("Product sent")}).catch(function(t){e.logger.info("Product not sent")})},o.prototype.findAndSendProductViewsByCssSelectors=function(t){var e,r=this,n=this.moduleConfig.getProductCaptureProductIdSelector();try{if(""==n)return void this.logger.info("ProductCapture: cssSelector selectors empty.");e=t.querySelectorAll(n.trim())}catch(t){return void this.logger.error("ProductCapture: findAndSendProductViews failure err = "+t)}var o=[];e.forEach(function(t){if(!r.moduleConfig.getProductCaptureProductIdSelectorVisibility()||r.isElementVisible(t)){var e=r.getElementContent(t,r.moduleConfig.getProductCaptureProductIdSelectorAttribute());e&&0<e.trim().length&&o.push(new ir({productId:e,timeStamp:(new Date).getTime()}))}}),this.sendProductView(o).then(function(t){r.logger.info("Product sent")}).catch(function(t){r.logger.info("Product not sent")})},o.prototype.productsEqual=function(t,e){for(var r=!0,n=0,o=t;n<o.length;n++){for(var i=o[n],s=!1,a=0,u=e;a<u.length;a++){var c=u[a];if(i.productId===c.productId){s=!0;break}}if(!s){r=!1;break}}return r},o.prototype.createProducts=function(t){var e=[],r=t;return Array.isArray(t)||(r=[t]),r.filter(function(t){return t.productId}).forEach(function(t){e.push(new ir(t))}),0<e.length?[e[0]]:e},o.prototype.sendProductFiddle=function(){return this.maw.sendProductFiddle({})},o.prototype.startProductFiddle=function(){if(this.stopProductFiddle(),0<this.fiddleInterval){var e=this;this.fiddleIntervalId=setInterval(function(){e.sendProductFiddle().then(function(t){}).catch(function(t){e.logger.info("ProductFiddle not sent")})},this.fiddleInterval)}},o.prototype.stopProductFiddle=function(){this.fiddleIntervalId&&clearInterval(this.fiddleIntervalId),this.fiddleIntervalId=void 0},o.PRODUCT_SENT_EXPIRE_MS=60*(o.PRODUCT_SENT_EXPIRE_MINUTES=30)*1e3,o.DELAY_START_MS=1e3,o.PRODUCT_VIEW_SEND_EVENT="bronto:productView:send",o}(),cr=function(){function r(t){this.productCapture=t,this.logger=f.getInstance().getLogger()}return r.prototype.start=function(){var t=this;if(g.getInstance().put(r.SEND_PRODUCT_VIEW_ACTION_NAME,this.productCapture.sendProductView.bind(this.productCapture)),"complete"===document.readyState){var e="ProductCaptureContainer: start readyState=complete, delaying start";this.logger.info(e),this.productCapture.delayedStart()}else{e="ProductCaptureContainer: start delaying further start to window load";this.logger.info(e),window.addEventListener("load",function(){return t.productCapture.delayedStart()})}},r.prototype.stop=function(){this.productCapture.stop()},r.SEND_PRODUCT_VIEW_ACTION_NAME="productView:send",r.NAME=sr,r}(),lr=f.getInstance(),dr=new cr(new ur(new or(lr.getConfig())));lr.registerContainer(cr.NAME,dr)}(this.bronto=this.bronto||{});
